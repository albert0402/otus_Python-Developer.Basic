# Django Магазин Расширенный с CBV (Class-Based Views) и использованием Pytest

Этот проект представляет собой магазин на Django с расширенной функциональностью, включая управление товарами, категориями, формами и админкой.

---

## 1. Создание Django-проекта и приложения

### Создание нового проекта Django
```bash
django-admin startproject config .
cd config
```

### Создание нового приложения Django
```bash
python manage.py startapp store_app
```

### Добавление приложения в `settings.py`
Откройте `config/settings.py` и добавьте `'store_app'` в `INSTALLED_APPS`:
```python
INSTALLED_APPS = [
    ...
    'store_app',
]
```

---

## 2. Определение моделей

### Модель категорий (Category)
Файл: `store_app/models.py`
- `name`: название категории (уникальное).
- `description`: описание категории.

### Модель товаров (Product)
Файл: `store_app/models.py`
- `name`: название товара.
- `description`: описание товара.
- `price`: цена товара.
- `created_at`: дата создания товара (автоматически заполняется).
- `categories`: связь с категориями через `ManyToManyField`.
- `is_published`: статус публикации товара.
- `is_available`: статус доступности товара.

---

## 3. Применение миграций
```bash
python manage.py makemigrations
python manage.py migrate
```

---

## 4. Работа с ORM

### Запуск команды для заполнения базы из файла `data_fixture.json`
```bash
python manage.py loaddata store_app/fixtures/data_fixture.json
```

### Запуск команды для выгрузки данных из базы в файл `dumped_data.json`
```bash
python manage.py dumpdata store_app --indent 4 > store_app/fixtures/dumped_data.json
```

---

## 5. Создание шаблонов

### Базовый шаблон (`base.html`)
- Используется для наследования всеми остальными шаблонами.
- Содержит блоки `title` и `content`.

### Меню (`menu.html`)
- Навигационное меню для перехода между страницами.
- Включает ссылки на главную страницу, список товаров, список категорий и страницу "О нас".

### Список товаров (`product_list.html`)
- Отображает список товаров с названием, описанием и ценой.
- Содержит кнопку для добавления нового товара.

### Детали товара (`product_detail.html`)
- Отображает все данные о товаре, включая категории, статус публикации и доступности.
- Содержит кнопки для редактирования товара и возврата к списку товаров.

### Форма добавления товара (`add_product.html`)
- Отображает форму для добавления нового товара.
- Валидирует введенные данные и отображает ошибки.

### Форма редактирования товара (`edit_product.html`)
- Отображает форму для редактирования существующего товара.
- Валидирует введенные данные и отображает ошибки.

### Список категорий (`category_list.html`)
- Отображает список категорий с названием и описанием.
- Содержит кнопки для добавления и редактирования категорий.

### Форма добавления категории (`add_category.html`)
- Отображает форму для добавления новой категории.
- Валидирует введенные данные и отображает ошибки.

### Форма редактирования категории (`edit_category.html`)
- Отображает форму для редактирования существующей категории.
- Валидирует введенные данные и отображает ошибки.

---

## 6. Создание форм

### Форма добавления и редактирования товара (`ProductModelForm`)
- Настроена для работы с моделью `Product`.
- Включает поля: `name`, `description`, `price`, `categories`, `is_published`, `is_available`.
- Реализована валидация для цены и названия товара.

### Форма добавления и редактирования категории (`CategoryModelForm`)
- Настроена для работы с моделью `Category`.
- Включает поля: `name`, `description`.
- Реализована валидация для названия категории.

---

## 7. Настройка админки

### Кастомизация админки для модели `Product`
- `list_display`: Отображает поля `name`, `price`, `get_categories`, `is_published`, `is_available`.
- `ordering`: Сортировка по названию и цене.
- `search_fields`: Поиск по названию и описанию товара.
- `fieldsets`: Группировка полей для удобства редактирования.
- `readonly_fields`: Поле `created_at` только для чтения.
- Кастомные действия:
  - **Add new product**: Добавляет новый товар с категорией по умолчанию.
  - **Update product details**: Обновляет название, описание и цену выбранных товаров.
  - **Set price to 500**: Устанавливает цену выбранных товаров на 500.
  - **Publish selected products**: Публикует выбранные товары.
  - **Mark as out of stock**: Отмечает выбранные товары как недоступные.

### Кастомизация админки для модели `Category`
- `list_display`: Отображает поля `name`, `description`.
- `ordering`: Сортировка по названию.
- `search_fields`: Поиск по названию и описанию категории.
- `fieldsets`: Группировка полей для удобства редактирования.
- Кастомные действия:
  - **Add new category**: Добавляет новую категорию с описанием по умолчанию.

---

## 8. Запуск сервера
```bash
python manage.py runserver
```

Перейдите по адресу `http://127.0.0.1:8000/`, чтобы увидеть ваш Django-проект.

---

## 9. Основные маршруты

- **Главная страница**: `http://127.0.0.1:8000/`
- **Список товаров**: `http://127.0.0.1:8000/products/`
- **Детали товара**: `http://127.0.0.1:8000/products/<product_id>/`
- **Добавление товара**: `http://127.0.0.1:8000/products/add/`
- **Редактирование товара**: `http://127.0.0.1:8000/products/edit/<product_id>/`
- **Список категорий**: `http://127.0.0.1:8000/categories/`
- **Добавление категории**: `http://127.0.0.1:8000/categories/add/`
- **Редактирование категории**: `http://127.0.0.1:8000/categories/edit/<category_id>/`
- **О нас**: `http://127.0.0.1:8000/about/`

---

## 10. Примеры использования

### Добавление товара
1. Перейдите на страницу `http://127.0.0.1:8000/products/add/`.
2. Заполните форму и нажмите "Сохранить".

### Редактирование товара
1. Перейдите на страницу товара (например, `http://127.0.0.1:8000/products/1/`).
2. Нажмите кнопку "Редактировать".
3. Внесите изменения и нажмите "Сохранить".

### Публикация товара через админку
1. Перейдите в админку: `http://127.0.0.1:8000/admin/`.
2. Выберите товары и примените действие "Publish selected products".

---

## 11. Зависимости

- Django 4.2+
- Python 3.8+