### Домашнее задание "Асинхронная работа с сетью и БД"

Этот проект разворачивает контейнер PostgreSQL через Docker Compose, инициализирует базу данных с помощью Alembic и запускает приложение на Python.

## 1. Предварительные требования

- **Docker** и **Docker Compose**  
  Убедитесь, что Docker установлен и запущен на вашей машине.
- **Python 3.x**  
  Для создания виртуального окружения и запуска приложения.
- **pip**  
  Для установки зависимостей из `requirements.txt`.

## 2. Структура проекта

Основные файлы и директории:
- `docker-compose.yml` — настройки для запуска контейнера PostgreSQL.
- `run.sh` (пример названия вашего скрипта) — Bash-скрипт, который:
  1. Запускает контейнер PostgreSQL в фоновом режиме.
  2. Активирует виртуальное окружение Python.
  3. Устанавливает зависимости из `requirements.txt`.
  4. Инициализирует Alembic (если не инициализировано).
  5. Создаёт и применяет миграции к базе данных.
  6. Запускает приложение `main.py`.
- `alembic/` — директория для миграций Alembic.
- `jsonplaceholder_requests.py` - парсинг данных с веб-страниц.
- `main.py` — основная точка входа приложения.
- `requirements.txt` — список Python-зависимостей.
- `.venv/` — (опционально) директория с виртуальным окружением Python.
- `models/` — директория с моделями SQLAlchemy (`Base`, `User`, `Post`, `Tag`).

## 3. Как запустить проект

1. **Склонировать репозиторий** (или скопировать файлы проекта):
   ```bash
   git clone https://github.com/username/repo_name.git
   cd repo_name
   ```
2. **Сделать Bash-скрипт исполняемым** (если требуется):
   ```bash
   chmod +x start_project.sh
   ```
3. **Запустить скрипт**:
   ```bash
   ./run.sh
   ```
   Скрипт выполнит следующие действия:
   - Поднимет контейнер PostgreSQL с помощью `docker compose up -d pg`.
   - Активирует виртуальное окружение Python (`.venv`).
   - Установит зависимости из `requirements.txt`.
   - Инициализирует Alembic (если это ещё не сделано).
   - Создаст и применит миграции (если они отсутствуют).
   - Запустит ваше Python-приложение (`main.py`).

После выполнения скрипта приложение будет работать, а в базе данных появятся необходимые таблицы.

## 4. Настройки подключения к базе данных

В `docker-compose.yml` для сервиса `pg` указаны следующие переменные окружения:

```yaml
services:
  pg:
    image: postgres:16.4
    environment:
      POSTGRES_DB: blog
      POSTGRES_USER: app
      POSTGRES_PASSWORD: apppassword
    ports:
      - "5432:5432"
    ...
```

Это означает:
- **Имя базы данных**: `blog`
- **Пользователь**: `app`
- **Пароль**: `apppassword`
- **Порт**: `5432`

## 5. Подключение к базе данных в VS Code (SQLTools)

Для удобного просмотра данных и выполнения SQL-запросов в VS Code можно использовать расширение **SQLTools**:

1. **Установите расширение SQLTools**:
   - В VS Code откройте панель Extensions (клавиши <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>X</kbd>).
   - Найдите и установите `SQLTools`.
   - Установите драйвер для PostgreSQL: `SQLTools PostgreSQL Driver`.

2. **Настройте подключение**:
   - В панели **SQLTools** выберите **Add New Connection**.
   - Заполните поля, как на скриншоте (или вручную):
     - **Connection name**: `test` (или любое другое название)
     - **Server Address**: `localhost`
     - **Port**: `5432`
     - **Database**: `blog`
     - **Username**: `app`
     - **Password**: `apppassword`
   - Остальные настройки оставьте по умолчанию или при необходимости укажите `statement_timeout`, `query_timeout`, и т.д.

3. **Подключитесь к базе**:
   - После сохранения настроек подключитесь к базе.
   - Откройте новый `.sql`-файл и выполните запрос, например:
     ```sql
     SELECT * FROM users;
     SELECT * FROM post;
     ```
     чтобы увидеть данные в таблицах.

## 6. Проверка данных

- **В консоли**:  
  Если вы предпочитаете консоль, можно зайти в контейнер PostgreSQL:
  ```bash
  docker compose exec pg psql -U app -d blog
  ```
  И выполнить запросы:
  ```sql
  \dt       -- Показать список таблиц
  SELECT * FROM users;  -- Пример просмотра данных
  ```
- **В VS Code (SQLTools)**:  
  Как описано выше, можно выполнить SQL-запросы через расширение и увидеть результат.

## 7. Завершение работы

Чтобы остановить контейнер PostgreSQL, выполните:
```bash
docker compose down
```
(Если у вас несколько сервисов, то при необходимости укажите конкретный сервис или используйте флаг `--rmi` для очистки образов.)

---

### Дополнительная информация

- **Alembic**:  
  Для управления миграциями используется Alembic. Файлы миграций находятся в `alembic/versions/`.  
  - Создать новую миграцию вручную:
    ```bash
    alembic revision -m "Your migration name"
    ```
    Затем отредактировать файл и применить:
    ```bash
    alembic upgrade head
    ```
- **Виртуальное окружение**:  
  Убедитесь, что перед запуском скрипта у вас создано и активировано окружение `.venv`. Если нет, создайте:
  ```bash
  python -m venv .venv
  source .venv/bin/activate  # Linux/Mac
  .venv\Scripts\activate   # Windows
  ```

На этом всё! Если возникнут вопросы, смотрите логи контейнера PostgreSQL:
```bash
docker compose logs pg
```
и логи вашего приложения. Удачи!

